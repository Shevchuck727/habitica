import { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "firebase/auth";
import { doc, setDoc, getDoc } from "firebase/firestore";
import { auth, db } from "./firebace";

// Ğ ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
export const registerUser = async (email, password, name) => {
    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        console.log("ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹:", user); // ğŸ” Ğ›Ğ¾Ğ³ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸

        // Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ² Firestore
        await setDoc(doc(db, "Users", user.uid), {
            Name: name,
            Email: email
        });

        console.log("ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¸Ğ¹ Ñƒ Firestore"); // ğŸ” Ğ›Ğ¾Ğ³ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸
        return user;
    } catch (error) {
        console.error("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ñ€ĞµÑ”ÑÑ‚Ñ€Ğ°Ñ†Ñ–Ñ—:", error.message);
        return null;
    }
};


// Ğ’Ñ…Ñ–Ğ´ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
export const loginUser = async (email, password) => {
    try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        return userCredential.user;
    } catch (error) {
        console.error("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ñƒ:", error.message);
        return null;
    }
};

// Ğ’Ğ¸Ñ…Ñ–Ğ´ Ğ· Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°
export const logoutUser = async () => {
    try {
        await signOut(auth);
    } catch (error) {
        console.error("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ²Ğ¸Ñ…Ğ¾Ğ´Ñƒ:", error.message);
    }
};

// ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
export const getCurrentUser = () => {
    return new Promise((resolve) => {
        onAuthStateChanged(auth, (user) => {
            resolve(user);
        });
    });
};
